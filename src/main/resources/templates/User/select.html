<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"  xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JKshian</title>

  <!------Font awesome cdn link-------->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">

  <!------CSS file link------->
  <link rel="stylesheet" href="../../static/css/style.css" th:href="@{/css/style.css}">
</head>

<body>
<!-- header section starts  -->
<header class="header">
  <a href="#" class="logo"><i class="fas fa-plane" aria-hidden="true"></i> JKshian</a>
  <nav class="navbar">
    <a href="index.html">Home</a>
    <a href="index.html">Booking</a>
    <a href="contact.html">contact</a>
  </nav>
  <a href="http://localhost:8080/api/v1/auth/login" >
    <img src="../../static/images/avatar.svg" th:src="@{/images/avatar.svg}" width="30px" height="30px"></a>
</header>


<br><br><br>

<section class="log">
  <img class="wave" src="../../static/images/wave.png" th:src="@{/images/wave.png}">

  <h1 >Choose Your Flight</h1>
  <form action="ticket.html" method="post"  >
    <table id="select-table">
      <thead>
      <tr>
        <th> </th>
        <th>Flight No</th>
        <th>From</th>
        <th>To</th>
        <th>Available Seats</th>
        <th>Km</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row1" >
        </label></td>

        <td> fg001</td>
        <td>London</td>
        <td>Paris</td>
        <td>1548</td>
        <td>200</td>


      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row2" >
        </label></td>

        <td>fg002</td>
        <td>Moskow</td>
        <td>London</td>
        <td>1234</td>
        <td>124</td>
      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row3">
        </label></td>

        <td>fg003</td>
        <td>Colombo</td>
        <td>Mumbai</td>
        <td>3099</td>
        <td>123</td>
      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row4">
        </label></td>

        <td>fg004</td>
        <td>Mumbai</td>
        <td>Kolkata</td>
        <td>1098</td>
        <td>45</td>
      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row5">
        </label></td>

        <td>fg003</td>
        <td>Colombo</td>
        <td>Mumbai</td>
        <td>3099</td>
        <td>123</td>
      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row6">
        </label></td>

        <td>fg003</td>
        <td>Colombo</td>
        <td>Mumbai</td>
        <td>3099</td>
        <td>123</td>
      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row7">
        </label></td>

        <td>fg003</td>
        <td>Colombo</td>
        <td>Mumbai</td>
        <td>3099</td>
        <td>123</td>
      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row8">
        </label></td>

        <td>fg003</td>
        <td>Colombo</td>
        <td>Mumbai</td>
        <td>3099</td>
        <td>123</td>
      </tr>
      <tr>
        <td><label>
          <input type="radio" name="selectedRow" value="row9">
        </label></td>

        <td>fg003</td>
        <td>Colombo</td>
        <td>Mumbai</td>
        <td>3099</td>
        <td>123</td>
      </tr>
      <!-- Add more rows as needed -->
      </tbody>
    </table>
    <br><br>
    <a th:href="@{/User/ticket}">
    <input type="submit" value="Choose" id="fa-choose">
    </a>
  </form>

</section>

<!-----Footer section starts----->
<div class="footer">
  <div class="row">
    <div class="footer-col-1">
      <h3>Download Our App</h3>
      <p>Download App for Android and jos mobile phone.</p>
      <div class="app-logo">
        <img src="../../static/images/play-store.png" th:src="@{/images/play-store.png}">
        <img src="../../static/images/app-store.png" th:src="@{/images/app-store.png}">
      </div>
    </div>
    <div class="footer-col-2">
      <a href="#" class="logo"><i class="fas fa-plane" aria-hidden="true"></i> JKshian</a>
    </div>
    <div class="footer-col-3">
      <h3>Useful Links</h3>
      <ul>
        <li>Coupons</li>
        <li>Blog Post</li>
        <li>Return Policy</li>
        <li>Join Affiliate</li>
      </ul>
    </div>
    <div class="footer-col-4">
      <h3>Follow us</h3>
      <ul>
        <li><i class="fa-brands fa-facebook"></i> Facebook</li>
        <li><i class="fa-brands fa-twitter"></i> Twitter</li>
        <li><i class="fa-brands fa-instagram"></i> Instagram</li>
        <li><i class="fa-brands fa-youtube"></i> Youtube</li>
      </ul>
    </div>
  </div>
  <hr>
  <p class="copyright">Copyright 2023 - JKshian Airlines</p>
</div>
<!-----Footer section ends------->

<!-----Custom js file link----->
<script type="text/javascript" >

  function handleFormSubmit(event) {
    event.preventDefault();

    const formData = {
      email: document.getElementById('username').value,
      password: document.getElementById('password').value,
      // Add more form fields here as needed
    };

    const errorMessage = document.getElementById('error-message');
    const loadingIndicator = document.getElementById('loading-indicator');

    errorMessage.textContent = ''; // Clear any previous error message
    loadingIndicator.style.display = 'block'; // Show loading indicator

    fetch('http://localhost:8080/api/v1/auth/authenticate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formData),
    })
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              return response.json();
            })
            .then(data => {
              const jwtToken = data.token;

              // Store the JWT token in localStorage
              localStorage.setItem('jwtToken', jwtToken);

              redirectToProtectedPage();

            })
            .catch(error => {
              errorMessage.textContent = 'Login failed. Please check your credentials.';
              console.error('Error:', error.message);
            })
            .finally(() => {
              loadingIndicator.style.display = 'none'; // Hide loading indicator
            });
  }
  function redirectToProtectedPage() {
    // Check if the JWT token is available in localStorage
    const jwtToken = localStorage.getItem('jwtToken');
    if (jwtToken) {
      fetch('http://localhost:8080/api/v1/demo-controller/index', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${jwtToken}`,
          'Content-Type': 'application/json',
        },
      })
              .then(response => {
                if (response.ok) {
                  // Redirect to the protected page
                  // window.location.href = 'path/to/protected_page.html';
                  return response.text();
                } else {
                  // Handle other response statuses here, if needed
                  console.error('Error:', response.status, response.statusText);
                }
              })
              .then(htmlContent => {
                // Render the HTML content in the current page
                document.body.innerHTML = htmlContent;
              })
              .catch(error => {
                console.error('Error:', error.message);
                // Handle errors here
              });
    } else {
      // If token is not available, redirect back to the login page
      window.location.href = 'http://localhost:8080/api/v1/auth/login';
    }
  }
  const loginForm = document.getElementById('loginForm');
  loginForm.addEventListener('submit', handleFormSubmit);
</script>
</body>
</html>
